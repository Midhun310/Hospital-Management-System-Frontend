<mat-toolbar color="primary">
  <span>Receptionist Dashboard</span>
</mat-toolbar>

<div class="dashboard-container">
  <mat-card class="dashboard-card" (click)="openAddPatientForm()">
    <mat-card-title>New Patients</mat-card-title>
  </mat-card>

  <mat-card class="dashboard-card" (click)="openPatientTable()">
    <mat-card-title>View Patients</mat-card-title>
  </mat-card>

  <mat-card class="dashboard-card" (click)="openBookAppointment()">
    <mat-card-title>Book Appointments</mat-card-title>
  </mat-card>

  <mat-card class="dashboard-card" (click)="openViewAppointments()">
    <mat-card-title>View Appointments</mat-card-title>
  </mat-card>
</div>

<!-- Add Patient Form -->
<div *ngIf="showAddForm" class="edit-form">
  <h2>Add New Patient</h2>
  <form #addForm="ngForm" (ngSubmit)="submitAddPatient()">
    <mat-card-content>
      <form #form="ngForm" class="form-grid">
        <div class="form-row"
          *ngFor="let field of ['name', 'mobile', 'age', 'gender' , 'address', 'patientSymptoms',  'visit']">
          <mat-form-field>
            <mat-label>{{ field | titlecase }}</mat-label>
            <ng-container [ngSwitch]="field">
              <input *ngSwitchCase="'name'" matInput [(ngModel)]="newPatient.name" name="name">
              <input *ngSwitchCase="'mobile'" matInput [(ngModel)]="newPatient.mobile" name="mobile">
              <input *ngSwitchCase="'age'" matInput [(ngModel)]="newPatient.age" name="age">

              <mat-select *ngSwitchCase="'gender'" [(ngModel)]="newPatient.gender" name="gender">
                <mat-option value="male">Male</mat-option>
                <mat-option value="female">Female</mat-option>
                <mat-option value="other">Other</mat-option>
              </mat-select>

              <input *ngSwitchCase="'address'" matInput [(ngModel)]="newPatient.address" name="address">
              <input *ngSwitchCase="'patientSymptoms'" matInput [(ngModel)]="newPatient.patientSymptoms"
                name="patientSymptoms">
              <mat-select *ngSwitchCase="'visit'" [(ngModel)]="newPatient.visit" name="visit">
                <mat-option value="new">new</mat-option>
                <mat-option value="follow-up">follow-up</mat-option>
                <mat-option value="emergency">emergency</mat-option>
              </mat-select>
            </ng-container>
          </mat-form-field>
        </div>
      </form>
    </mat-card-content>
    <button class="save" mat-button (click)="cancelAdd()">Cancel</button>
    <button class="cancel" mat-raised-button (click)="submitAddPatient()">Submit</button>
  </form>
</div>

<!-- View Patients Table -->
<div *ngIf="showPatientTable" class="patient-details">
  <h2>Patient Details</h2>
  <table mat-table [dataSource]="patients" class="mat-elevation-z8">
    <ng-container matColumnDef="sno">
      <th mat-header-cell *matHeaderCellDef> S.No </th>
      <td mat-cell *matCellDef="let element; let i = index">{{ i + 1 }}</td>
    </ng-container>

    <ng-container matColumnDef="name">
      <th mat-header-cell *matHeaderCellDef> Name </th>
      <td mat-cell *matCellDef="let r">{{ r.name }}</td>
    </ng-container>

    <ng-container matColumnDef="mobile">
      <th mat-header-cell *matHeaderCellDef> Mobile </th>
      <td mat-cell *matCellDef="let r">{{ r.mobile }}</td>
    </ng-container>

    <ng-container matColumnDef="age">
      <th mat-header-cell *matHeaderCellDef> Age </th>
      <td mat-cell *matCellDef="let r">{{ r.age }}</td>
    </ng-container>

    <ng-container matColumnDef="gender">
      <th mat-header-cell *matHeaderCellDef> Gender </th>
      <td mat-cell *matCellDef="let r">{{ r.gender }}</td>
    </ng-container>

    <ng-container matColumnDef="patientSymptoms">
      <th mat-header-cell *matHeaderCellDef> Symptoms </th>
      <td mat-cell *matCellDef="let r">{{ r.patientSymptoms }}</td>
    </ng-container>

    <ng-container matColumnDef="visit">
      <th mat-header-cell *matHeaderCellDef> Visit </th>
      <td mat-cell *matCellDef="let r">{{ r.visit }}</td>
    </ng-container>

    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef> Actions </th>
      <td mat-cell *matCellDef="let patient">
        <button class="edit" mat-raised-button (click)="editPatient(patient)">Edit</button>
      </td>
    </ng-container>

    <tr mat-header-row
      *matHeaderRowDef="['sno', 'name', 'mobile', 'age', 'gender', 'patientSymptoms', 'visit', 'actions']"></tr>
    <tr mat-row
      *matRowDef="let row; columns: ['sno', 'name', 'mobile', 'age', 'gender', 'patientSymptoms', 'visit', 'actions']">
    </tr>
  </table>
</div>

<!-- Edit Form -->
<div *ngIf="editingPatient" class="edit-form">
  <h2>Edit Patient</h2>
  <form #editForm="ngForm" (ngSubmit)="updatePatient()">
    <mat-form-field>
      <mat-label>Name</mat-label>
      <input matInput [(ngModel)]="editingPatient.name" name="name" required />
    </mat-form-field>

    <mat-form-field>
      <mat-label>Mobile</mat-label>
      <input matInput [(ngModel)]="editingPatient.mobile" name="mobile" required />
    </mat-form-field>

    <mat-form-field>
      <mat-label>Age</mat-label>
      <input matInput [(ngModel)]="editingPatient.age" name="age" type="number" required />
    </mat-form-field>

    <mat-form-field>
      <mat-label>Gender</mat-label>
      <mat-select [(ngModel)]="editingPatient.gender" name="gender" required>
        <mat-option value="male">Male</mat-option>
        <mat-option value="female">Female</mat-option>
        <mat-option value="other">Other</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field>
      <mat-label>Address</mat-label>
      <input matInput [(ngModel)]="editingPatient.address" name="address" required />
    </mat-form-field>

    <mat-form-field>
      <mat-label>Symptoms</mat-label>
      <input matInput [(ngModel)]="editingPatient.patientSymptoms" name="patientSymptoms" required />
    </mat-form-field>

    <mat-form-field>
      <mat-label>Visit</mat-label>
      <mat-select [(ngModel)]="editingPatient.visit" name="visit" required>
        <mat-option value="new">New</mat-option>
        <mat-option value="follow-up">Follow-up</mat-option>
        <mat-option value="emergency">Emergency</mat-option>
      </mat-select>
    </mat-form-field>
    <div>
      <button class="update" mat-raised-button color="primary" type="submit">Update</button>
      <button class="cancel" mat-raised-button color="warn" type="button" (click)="cancelEdit()">Cancel</button>
    </div>
  </form>
</div>

<!-- Book Appointment Section -->
<div *ngIf="showBookingTable" class="booking-table">
  <h2>Book Appointment</h2>
  <table mat-table [dataSource]="patients" class="mat-elevation-z8">

    <ng-container matColumnDef="sno">
      <th mat-header-cell *matHeaderCellDef> S.No </th>
      <td mat-cell *matCellDef="let element; let i = index"> {{ i + 1 }} </td>
    </ng-container>

    <ng-container matColumnDef="name">
      <th mat-header-cell *matHeaderCellDef> Name </th>
      <td mat-cell *matCellDef="let patient"> {{ patient.name }} </td>
    </ng-container>

    <ng-container matColumnDef="mobile">
      <th mat-header-cell *matHeaderCellDef> Mobile </th>
      <td mat-cell *matCellDef="let patient"> {{ patient.mobile }} </td>
    </ng-container>

    <ng-container matColumnDef="age">
      <th mat-header-cell *matHeaderCellDef> Age </th>
      <td mat-cell *matCellDef="let patient"> {{ patient.age }} </td>
    </ng-container>

    <ng-container matColumnDef="gender">
      <th mat-header-cell *matHeaderCellDef> Gender </th>
      <td mat-cell *matCellDef="let patient"> {{ patient.gender }} </td>
    </ng-container>

    <ng-container matColumnDef="patientSymptoms">
      <th mat-header-cell *matHeaderCellDef> Symptoms </th>
      <td mat-cell *matCellDef="let patient"> {{ patient.patientSymptoms }} </td>
    </ng-container>

    <ng-container matColumnDef="visit">
      <th mat-header-cell *matHeaderCellDef> Visit </th>
      <td mat-cell *matCellDef="let patient"> {{ patient.visit }} </td>
    </ng-container>

    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef> Action </th>
      <td mat-cell *matCellDef="let patient">
        <button class="edit" mat-raised-button (click)="selectPatient(patient)">Book</button>
      </td>
    </ng-container>

    <tr mat-header-row
      *matHeaderRowDef="['sno', 'name', 'mobile', 'age', 'gender', 'patientSymptoms', 'visit', 'actions']"></tr>
    <tr mat-row
      *matRowDef="let row; columns: ['sno', 'name', 'mobile', 'age', 'gender', 'patientSymptoms', 'visit', 'actions']">
    </tr>
  </table>

  <!-- Show Doctor list -->
  <div *ngIf="showDoctorList && selectedPatientForBooking">
    <h3>Select Doctor for: {{ selectedPatientForBooking.name }}</h3>

    <div *ngIf="doctors.length > 0; else noDoctorsFound">
      <table mat-table [dataSource]="doctors" class="mat-elevation-z8">
        <ng-container matColumnDef="sno">
          <th mat-header-cell *matHeaderCellDef> S.No </th>
          <td mat-cell *matCellDef="let element; let i = index"> {{ i + 1 }} </td>
        </ng-container>

        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef> Name </th>
          <td mat-cell *matCellDef="let doctor"> {{doctor.name}} </td>
        </ng-container>

        <ng-container matColumnDef="department">
          <th mat-header-cell *matHeaderCellDef> Department </th>
          <td mat-cell *matCellDef="let doctor"> {{doctor.department}} </td>
        </ng-container>

        <ng-container matColumnDef="shift">
          <th mat-header-cell *matHeaderCellDef> Shift </th>
          <td mat-cell *matCellDef="let doctor"> {{doctor.shift}} </td>
        </ng-container>

        <ng-container matColumnDef="workStatus">
          <th mat-header-cell *matHeaderCellDef> Work Status </th>
          <td mat-cell *matCellDef="let doctor"> {{doctor.workStatus}} </td>
        </ng-container>

        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef> Actions </th>
          <td mat-cell *matCellDef="let doctor">
            <button class="update" mat-raised-button (click)="selectDoctor(doctor)">Select</button>
          </td>
        </ng-container>

        <!-- Header & Row -->
        <tr mat-header-row *matHeaderRowDef="['sno', 'name', 'department', 'shift','workStatus', 'actions']"></tr>
        <tr mat-row *matRowDef="let row; columns: ['sno', 'name', 'department',  'shift', 'workStatus', 'actions'];">
        </tr>
      </table>
    </div>
    <ng-template #noDoctorsFound> 
      <p>No active doctors available.</p>
    </ng-template>

    <!-- Appointment Form -->
    <div *ngIf="selectedDoctor" class="edit-form">
      <h4>Booking Appointment with Dr. {{ selectedDoctor.name }}</h4>
      <div class="date">
        <mat-form-field>
          <mat-label>Date</mat-label>
          <input matInput type="date" [(ngModel)]="bookingDate" name="bookingDate" required />
        </mat-form-field>
      </div>

      <div class="date">
        <mat-form-field>
          <mat-label>Time</mat-label>
          <input matInput type="time" [(ngModel)]="bookingTime" name="bookingTime" required />
        </mat-form-field>
      </div>

      <button class="update" mat-raised-button (click)="confirmBooking()">Book Appointment</button>
    </div>
  </div>
</div>

<!-- View Appointments Table -->
<div *ngIf="showAppointmentTable" class="appointment-table">
  <h2>Appointments</h2>
  <table mat-table [dataSource]="appointments" class="mat-elevation-z8">

    <ng-container matColumnDef="sno">
      <th mat-header-cell *matHeaderCellDef> S.No </th>
      <td mat-cell *matCellDef="let row; let i = index"> {{ i + 1 }} </td>
    </ng-container>

    <ng-container matColumnDef="patient">
      <th mat-header-cell *matHeaderCellDef> Patient Name </th>
      <td mat-cell *matCellDef="let row"> {{ row.patient?.name || row.patientName }} </td>
    </ng-container>

    <ng-container matColumnDef="doctor">
      <th mat-header-cell *matHeaderCellDef> Doctor Name </th>
      <td mat-cell *matCellDef="let row"> {{ row.doctor?.name || row.doctorName }} </td>
    </ng-container>

    <ng-container matColumnDef="date">
      <th mat-header-cell *matHeaderCellDef> Date </th>
      <td mat-cell *matCellDef="let row"> {{ row.appointment?.date | date: 'shortDate' }} </td>
    </ng-container>

    <ng-container matColumnDef="time">
      <th mat-header-cell *matHeaderCellDef> Time </th>
      <td mat-cell *matCellDef="let row"> {{ row.appointment?.time }} </td>
    </ng-container>

    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef> Actions </th>
      <td mat-cell *matCellDef="let row">
        <button class="edit" mat-raised-button (click)="editAppointment(row)">Edit</button>
      </td>
    </ng-container>

    <ng-container matColumnDef="status">
      <th mat-header-cell *matHeaderCellDef> Status </th>
      <td mat-cell *matCellDef="let row"> {{ row.appointment?.status || 'scheduled' }} </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="['sno', 'patient', 'doctor', 'date', 'time', 'status', 'actions']"></tr>
    <tr mat-row *matRowDef="let row; columns: ['sno', 'patient', 'doctor', 'date', 'time', 'status', 'actions']"></tr>
  </table>

  <!-- Edit Appointment Form -->
  <div *ngIf="editingAppointment" class="edit-form">

    <h2>Edit Appointments</h2>
    <form (ngSubmit)="updateAppointment()" #editAppForm="ngForm">

      <mat-form-field>
        <mat-label>Patient</mat-label>
        <mat-select [(ngModel)]="editingAppointment.patientId" name="patientId" required>
          <mat-option *ngFor="let p of patients" [value]="p._id">{{ p.name }}</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field>
        <mat-label>Doctor</mat-label>
        <mat-select [(ngModel)]="editingAppointment.doctorId" name="doctorId" required>
          <mat-option *ngFor="let d of doctors" [value]="d._id">{{ d.name }}</mat-option>
        </mat-select>
      </mat-form-field>


      <mat-form-field>
        <mat-label>Date</mat-label>
        <input matInput type="date" [(ngModel)]="editingAppointment.date" name="date" required />
      </mat-form-field>

      <mat-form-field>
        <mat-label>Time</mat-label>
        <input matInput type="time" [(ngModel)]="editingAppointment.time" name="time" required />
      </mat-form-field>

      <mat-form-field>
        <mat-label>Status</mat-label>
        <mat-select [(ngModel)]="editingAppointment.status" name="status" required>
          <mat-option value="scheduled">Scheduled</mat-option>
          <mat-option value="completed">Completed</mat-option>
          <mat-option value="cancelled">Cancelled</mat-option>
        </mat-select>
      </mat-form-field>
      <div>
        <button class="update" mat-raised-button color="primary" type="submit">Update</button>
        <button class="cancel" mat-raised-button color="warn" type="button"
          (click)="cancelEditappointment()">Cancel</button>
      </div>
    </form>
  </div>
</div>
